<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Bitcoin Tracker (Realtime)</title>

<style>
html, body {
  margin: 0;
  padding: 0;
  width: 100%;
  height: 100%;
  background: #0a0f1a;
  color: #fff;
  font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
  box-sizing: border-box;
  overflow: hidden;
}

body {
  display: flex;
  justify-content: center;
  align-items: center;
}

.container {
  width: calc(100vw - 100px);
  height: calc(100vh - 100px);
  display: flex;
  flex-direction: column;
  gap: 2vh;
  padding: 2vh 2vw;
  box-sizing: border-box;
}

.top-plate {
  background: linear-gradient(to bottom, #0f1526, #121b2f);
  border-radius: 0.5vw;
  padding: 2vh 2vw;
  display: flex;
  justify-content: space-between;
  align-items: center;
  border: 1px solid #1e2a44;
}
.title { font-weight: 700; font-size: 2.5vw; }
.subtitle { color: #a0aec0; font-size: 1vw; }
.price { font-size: 3vw; font-weight: 800; margin-top: 1vh; }

.change {
  margin-top: 1vh;
  background-color: rgba(16,185,129,0.35);
  color: #6ee7b7;
  font-weight: 600;
  padding: 0.5vh 1vw;
  border-radius: 1vw;
  font-size: 1vw;
  display: inline-flex;
  align-items: center;
}
.change.down { background-color: rgba(239,68,68,0.35); color: #f87171; }
.change .arrow { margin-right: 0.5vw; font-weight: 900; font-size: 1.5vw; }

.chart-container {
  background: #0a0f1a;
  border-radius: 0.5vw;
  padding: 2vh 2vw;
  flex-grow: 1;
  display: flex;
  flex-direction: column;
  overflow: hidden;
  border: 1px solid #1e2a44;
}

#priceChart {
  width: 100% !important;
  height: 100% !important;
}
</style>
</head>

<body>
<div class="container">

  <div class="top-plate">
    <div>
      <div class="title">Bitcoin</div>
      <div class="subtitle">BTC/USDT (Binance)</div>
      <div class="price" id="currentPrice">$--.--</div>

      <div class="change" id="priceChange">
        <span class="arrow" id="changeArrow">↑</span>
        <span id="changePercent">0.00%</span> 24h
      </div>
    </div>
  </div>

  <div class="chart-container">
    <canvas id="priceChart"></canvas>
  </div>

</div>

<!-- Chart.js CDN (safe) -->
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.3.0/dist/chart.umd.min.js"></script>

<script>
/* DOM Elements */
const currentPriceEl = document.getElementById('currentPrice');
const priceChangeEl = document.getElementById('priceChange');
const changeArrowEl = document.getElementById('changeArrow');
const changePercentEl = document.getElementById('changePercent');

/* Chart Data Buffers */
let priceData = [];
let timeLabels = [];
let priceChart = null;

/* Create Chart */
function initChart() {
  const ctx = document.getElementById("priceChart").getContext("2d");

  priceChart = new Chart(ctx, {
    type: "line",
    data: {
      labels: timeLabels,
      datasets: [{
        label: "BTC/USDT",
        data: priceData,
        borderColor: "#22c55e",
        backgroundColor: "rgba(34,197,94,0.3)",
        fill: true,
        pointRadius: 0,
        borderWidth: 2,
        tension: 0.4
      }]
    },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      animation: false,
      resizeDelay: 150,
      scales: {
        y: { ticks: { color: "#94a3b8" }, grid: { color: "rgba(147,197,253,0.1)" }},
        x: { ticks: { color: "#94a3b8" }, grid: { display: false }}
      },
      plugins: { legend: { display: false } }
    }
  });
}

/* Update UI Price */
function updatePriceUI(price, prevPrice) {
  currentPriceEl.textContent = "$" + price.toLocaleString("en-US", {
    minimumFractionDigits: 2,
    maximumFractionDigits: 2
  });

  if (prevPrice == null) return;

  const diff = price - prevPrice;
  const percent = (diff / prevPrice) * 100;

  changePercentEl.textContent = Math.abs(percent).toFixed(2) + "%";

  if (percent >= 0) {
    changeArrowEl.textContent = "↑";
    priceChangeEl.classList.remove("down");
  } else {
    changeArrowEl.textContent = "↓";
    priceChangeEl.classList.add("down");
  }
}

/* Update Chart */
function updateChart(price) {
  const timestamp = new Date().toLocaleTimeString([], {
    hour: "2-digit", minute: "2-digit", second: "2-digit"
  });

  if (priceData.length > 300) {
    priceData.shift();
    timeLabels.shift();
  }

  priceData.push(price);
  timeLabels.push(timestamp);

  if (priceChart) {
    priceChart.update("none");
  }
}

/* REALTIME WEBSOCKET */
let lastPrice = null;

function startRealtime() {
  const ws = new WebSocket("wss://stream.binance.com:9443/ws/btcusdt@trade");

  ws.onmessage = (event) => {
    const msg = JSON.parse(event.data);
    const price = parseFloat(msg.p);

    updatePriceUI(price, lastPrice);
    updateChart(price);

    lastPrice = price;
  };

  ws.onclose = () => {
    console.warn("WebSocket closed — reconnecting...");
    setTimeout(startRealtime, 1000);
  };
}

/* INIT */
initChart();
startRealtime();

</script>
</body>
</html>
