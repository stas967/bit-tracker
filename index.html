<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Real-Time Bitcoin Tracker</title>
<style>
html, body {
  margin: 0;
  padding: 0;
  width: 100%;
  height: 100%;
  background: #0a0f1a;
  color: #fff;
  font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
  box-sizing: border-box;
  overflow: hidden;
}
body {
  display: flex;
  justify-content: center;
  align-items: center;
}
.container {
  width: calc(100vw - 100px);
  height: calc(100vh - 100px);
  display: flex;
  flex-direction: column;
  gap: 2vh;
  padding: 2vh 2vw;
  box-sizing: border-box;
}
.top-plate {
  background: linear-gradient(to bottom, #0f1526, #121b2f);
  border-radius: 0.5vw;
  padding: 2vh 2vw;
  display: flex;
  justify-content: space-between;
  align-items: center;
  border: 1px solid #1e2a44;
}
.top-left { display: flex; flex-direction: column; }
.title { font-weight: 700; font-size: 2.5vw; line-height: 1.2; }
.subtitle { color: #a0aec0; font-size: 1vw; margin-top: 0.5vh; }
.price { font-size: 3vw; font-weight: 800; margin-top: 1vh; }
.change {
  margin-top: 1vh;
  background-color: rgba(16,185,129,0.35);
  color: #6ee7b7;
  font-weight: 600;
  padding: 0.5vh 1vw;
  border-radius: 1vw;
  font-size: 1vw;
  display: inline-flex;
  align-items: center;
}
.change.down { background-color: rgba(239,68,68,0.35); color: #f87171; }
.change .arrow { margin-right: 0.5vw; font-weight: 900; font-size: 1.5vw; line-height: 1; }
.stats-row { display: flex; gap: 1vw; justify-content: space-between; flex-wrap: wrap; }
.stat-card { flex: 1; min-width: 15vw; background: #0a0f1a; border-radius: 0.5vw; padding: 1.5vh 1.5vw; display: flex; flex-direction: column; align-items: center; border: 1px solid #1e2a44; }
.stat-title { font-size: 1vw; color: #a0aec0; margin-bottom: 0.5vh; font-weight: 600; }
.stat-value { font-size: 1.5vw; font-weight: 700; }
.stat-value.high { color: #22c55e; }
.stat-value.low { color: #ef4444; }
.stat-value.cap { color: #fbbf24; }
.chart-container {
  background: #0a0f1a;
  border-radius: 0.5vw;
  padding: 2vh 2vw;
  flex-grow: 1;
  display: flex;
  flex-direction: column;
  box-sizing: border-box;
  overflow: hidden;
  border: 1px solid #1e2a44;
}
#priceChart { width: 100% !important; height: 100% !important; max-height: 100%; box-sizing: border-box; }
</style>
</head>
<body>
<div class="container">
  <div class="top-plate">
    <div class="top-left">
      <div class="title">Bitcoin</div>
      <div class="subtitle">BTC/USDT</div>
      <div class="price" id="currentPrice">$--.--</div>
      <div class="change" id="priceChange">
        <span class="arrow" id="changeArrow">↑</span>
        <span id="changePercent">0.00%</span> 24h
      </div>
    </div>
  </div>
  <div class="stats-row">
    <div class="stat-card">
      <div class="stat-title">24h High</div>
      <div class="stat-value high" id="high24h">$--.--</div>
    </div>
    <div class="stat-card">
      <div class="stat-title">24h Low</div>
      <div class="stat-value low" id="low24h">$--.--</div>
    </div>
    <div class="stat-card">
      <div class="stat-title">Market Cap</div>
      <div class="stat-value cap" id="marketCap">$--.--B</div>
    </div>
  </div>
  <div class="chart-container">
    <canvas id="priceChart" role="img" aria-label="Bitcoin price live chart"></canvas>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
const currentPriceEl = document.getElementById('currentPrice');
const priceChangeEl = document.getElementById('priceChange');
const changeArrowEl = document.getElementById('changeArrow');
const changePercentEl = document.getElementById('changePercent');
const high24hEl = document.getElementById('high24h');
const low24hEl = document.getElementById('low24h');
const marketCapEl = document.getElementById('marketCap');

let priceChart;
let priceData = [];
let timeLabels = [];
let lastUpdate = 0;
const updateInterval = 500; // 0.5s throttle

function formatNumber(num, decimals=2) {
  return num.toLocaleString('en-US',{minimumFractionDigits:decimals, maximumFractionDigits:decimals});
}

// Initialize Chart
const ctx = document.getElementById('priceChart').getContext('2d');
priceChart = new Chart(ctx, {
  type: 'line',
  data: { labels: timeLabels, datasets:[{
    label:'BTC/USDT',
    data: priceData,
    borderColor:'#22c55e',
    backgroundColor:'rgba(34,197,94,0.3)',
    fill:true,
    pointRadius: 0,
    borderWidth: 2,
    tension: 0.4
  }]},
  options:{
    responsive:true,
    maintainAspectRatio:false,
    animation:false,
    scales:{
      y:{beginAtZero:false, ticks:{color:'#94a3b8'}, grid:{color:'rgba(147,197,253,0.1)'}},
      x:{ticks:{color:'#94a3b8'}, grid:{display:false}}
    },
    plugins:{legend:{display:false}}
  }
});

// Binance WebSocket for real-time BTC/USDT trades
const ws = new WebSocket("wss://stream.binance.com:9443/ws/btcusdt@trade");

let lastPrice = null;
ws.onmessage = (event) => {
  const data = JSON.parse(event.data);
  const currentPrice = parseFloat(data.p);
  const now = new Date();
  const label = now.toLocaleTimeString([], {hour:'2-digit',minute:'2-digit',second:'2-digit'});

  // 0.5s throttled update
  const nowMs = Date.now();
  if (nowMs - lastUpdate < updateInterval) return;
  lastUpdate = nowMs;

  // Update chart data
  if(priceData.length >= 3600) { // keep ~1h assuming 1s ticks
    priceData.shift();
    timeLabels.shift();
  }
  priceData.push(currentPrice);
  timeLabels.push(label);

  priceChart.data.labels = timeLabels;
  priceChart.data.datasets[0].data = priceData;

  // Dynamic Y-axis zoom in $100 bands
  const segment = 100;
  const base = Math.floor(currentPrice / segment) * segment;
  priceChart.options.scales.y.min = base;
  priceChart.options.scales.y.max = base + segment;
  priceChart.update('none');

  // Update top plate
  currentPriceEl.textContent = `$${formatNumber(currentPrice,2)}`;
  if(lastPrice !== null){
    const change24h = ((currentPrice - lastPrice)/lastPrice)*100;
    const isPositive = change24h >= 0;
    changeArrowEl.textContent = isPositive ? '↑' : '↓';
    changePercentEl.textContent = `${Math.abs(change24h).toFixed(2)}%`;
    priceChangeEl.className = 'change' + (isPositive ? '' : ' down');
  }
  lastPrice = currentPrice;
};

// Fetch 24h stats from Binance REST API once at start
async function fetchStats() {
  try {
    const res = await fetch("https://api.binance.com/api/v3/ticker/24hr?symbol=BTCUSDT");
    const data = await res.json();
    high24hEl.textContent = `$${formatNumber(parseFloat(data.highPrice),2)}`;
    low24hEl.textContent = `$${formatNumber(parseFloat(data.lowPrice),2)}`;
    marketCapEl.textContent = `$--`; // Binance API doesn't provide market cap directly
  } catch(e) { console.error(e); }
}
fetchStats();
</script>
</body>
</html>
