<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Bitcoin Tracker</title>

<style>
html, body {
  margin: 0; padding: 0;
  width: 100%; height: 100%;
  background: #0a0f1a;
  color: #fff;
  font-family: 'Segoe UI', Tahoma, sans-serif;
  overflow: hidden;
}

body {
  display: flex; justify-content: center; align-items: center;
}

.container {
  width: calc(100vw - 100px);
  height: calc(100vh - 100px);
  display: flex;
  flex-direction: column;
  gap: 2vh;
  padding: 2vh 2vw;
}

.top-plate {
  background: linear-gradient(to bottom, #0f1526, #121b2f);
  border-radius: 0.5vw;
  padding: 2vh 2vw;
  display: flex; align-items: center;
  border: 1px solid #1e2a44;
}

.title { font-weight: 700; font-size: 2.5vw; }
.subtitle { color: #a0aec0; font-size: 1vw; }

.price {
  font-size: 3vw; font-weight: 800; margin-top: 1vh;
}

.change {
  margin-top: 1vh;
  background-color: rgba(16,185,129,0.35);
  color: #6ee7b7;
  padding: 0.6vh 1vw;
  border-radius: 0.8vw;
  font-size: 1vw; font-weight: 600;
}
.change.down {
  background-color: rgba(239,68,68,0.35); color: #f87171;
}

.stats-row {
  display: flex; gap: 1vw; justify-content: space-between;
}
.stat-card {
  flex: 1; min-width: 15vw;
  background: #0a0f1a;
  padding: 1.5vh 1vw;
  border-radius: 0.5vw;
  border: 1px solid #1e2a44;
  display: flex; flex-direction: column; align-items: center;
}
.stat-title { font-size: 1vw; color: #a0aec0; }
.stat-value { font-size: 1.5vw; font-weight: 700; }
.stat-value.high { color: #22c55e; }
.stat-value.low { color: #ef4444; }
.stat-value.cap { color: #fbbf24; }

.chart-container {
  flex-grow: 1; padding: 2vh 2vw;
  background: #0a0f1a;
  border: 1px solid #1e2a44;
  border-radius: 0.5vw;
  overflow: hidden;
}

</style>
</head>
<body>

<div class="container">

  <div class="top-plate">
      <div>
        <div class="title">Bitcoin</div>
        <div class="subtitle">BTC/USD</div>
        <div class="price" id="currentPrice">$--.--</div>
        <div class="change" id="priceChange">
          <span id="changePercent">0.00%</span> 24h
        </div>
      </div>
  </div>

  <div class="stats-row">
    <div class="stat-card">
      <div class="stat-title">24h High</div>
      <div class="stat-value high" id="high24h">$--.--</div>
    </div>

    <div class="stat-card">
      <div class="stat-title">24h Low</div>
      <div class="stat-value low" id="low24h">$--.--</div>
    </div>

    <div class="stat-card">
      <div class="stat-title">Market Cap</div>
      <div class="stat-value cap" id="marketCap">$--.--B</div>
    </div>
  </div>

  <div class="chart-container">
    <canvas id="priceChart"></canvas>
  </div>

</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
/* UI Elements */
const priceEl = document.getElementById("currentPrice");
const changeEl = document.getElementById("priceChange");
const changePercentEl = document.getElementById("changePercent");
const highEl = document.getElementById("high24h");
const lowEl = document.getElementById("low24h");
const capEl = document.getElementById("marketCap");

/* Chart Data */
let chart;
let prices = [];
let labels = [];
const maxPoints = 3600; // 1 hour @ 1 update/sec (approx)

function formatPrice(p) {
  return Number(p).toLocaleString("en-US", {
    minimumFractionDigits: 2,
    maximumFractionDigits: 2
  });
}

/* --- 24h stats (once every minute) --- */
async function load24hStats() {
  try {
    const r = await fetch("https://api.binance.com/api/v3/ticker/24hr?symbol=BTCUSDT");
    const d = await r.json();

    changePercentEl.textContent = Number(d.priceChangePercent).toFixed(2) + "%";
    changeEl.className = "change " + (d.priceChangePercent >= 0 ? "" : "down");

    highEl.textContent = "$" + formatPrice(d.highPrice);
    lowEl.textContent = "$" + formatPrice(d.lowPrice);

    capEl.textContent = "$" + (Number(d.lastPrice) * 19650000 / 1e9).toFixed(2) + "B"; 
  } catch(e) {
    console.error("24h stat load fail:", e);
  }
}
load24hStats();
setInterval(load24hStats, 60000);

/* --- Create Chart --- */
const ctx = document.getElementById("priceChart").getContext("2d");

chart = new Chart(ctx, {
  type: "line",
  data: {
    labels: labels,
    datasets: [{
      label: "BTC Price",
      data: prices,
      borderColor: "#22c55e",
      backgroundColor: "rgba(34,197,94,0.25)",
      borderWidth: 2,
      tension: 0.35,
      pointRadius: 0
    }]
  },
  options: {
    animation: { duration: 600 }, // smooth transitions
    responsive: true,
    maintainAspectRatio: false,
    scales: {
      y: {
        min: 80000,
        max: 85000,
        ticks: { color: "#94a3b8" },
        grid: { color: "rgba(255,255,255,0.04)" }
      },
      x: {
        ticks: { color: "#94a3b8" },
        grid: { display: false }
      }
    },
    plugins: { legend: { display: false } }
  }
});

/* --- Dynamic 5k Price Segments --- */
function updateYAxis(price) {
  const segment = 5000;
  const base = Math.floor(price / segment) * segment;

  chart.options.scales.y.min = base;
  chart.options.scales.y.max = base + segment;
}

/* --- WebSocket Real-time Feed --- */
function startSocket() {
  const ws = new WebSocket("wss://stream.binance.com:9443/ws/btcusdt@trade");

  ws.onmessage = (msg) => {
    const data = JSON.parse(msg.data);
    const price = Number(data.p);

    /* Update UI */
    priceEl.textContent = "$" + formatPrice(price);

    /* Update segmented Y-axis */
    updateYAxis(price);

    /* Chart buffer */
    const now = new Date().toLocaleTimeString();
    prices.push(price);
    labels.push(now);

    if (prices.length > maxPoints) {
      prices.shift();
      labels.shift();
    }

    chart.update();
  };

  ws.onclose = () => {
    setTimeout(startSocket, 1000);
  };
}

startSocket();
</script>

</body>
</html>
